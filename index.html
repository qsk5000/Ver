<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تأكيد الحساب — Mizan Academy</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --navy: #0A0F1E;
            --gold: #C8A84B;
            --white: #FFFFFF;
            --success: #1DB97E;
            --danger: #E8455A;
        }
        body {
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            background: var(--navy); font-family: 'Tajawal', sans-serif; padding: 20px;
        }
        .card {
            background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(20px);
            border: 1px solid rgba(200,168,75,0.2); border-radius: 24px;
            padding: 40px; width: 100%; max-width: 400px; text-align: center;
        }
        .status-icon {
            width: 80px; height: 80px; border-radius: 50%; display: inline-flex;
            align-items: center; justify-content: center; font-size: 40px; margin-bottom: 20px;
        }
        .loading-icon { color: var(--gold); animation: spin 2s linear infinite; }
        .success-icon { background: rgba(29,185,126,0.1); color: var(--success); }
        .error-icon { background: rgba(232,69,90,0.1); color: var(--danger); }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        h1 { color: var(--white); font-size: 22px; margin-bottom: 15px; }
        p { color: rgba(255,255,255,0.6); line-height: 1.6; margin-bottom: 25px; }
        
        .btn {
            display: inline-block; padding: 12px 30px; background: var(--gold);
            color: var(--navy); text-decoration: none; border-radius: 10px;
            font-weight: bold; transition: 0.3s; display: none;
        }
    </style>
</head>
<body>

<div class="card" id="statusCard">
    <div id="iconContainer" class="status-icon">
        <i class="fas fa-circle-notch loading-icon"></i>
    </div>
    <h1 id="title">جاري تأكيد بريدك...</h1>
    <p id="description">يرجى الانتظار لحظة بينما نقوم بالتحقق من حسابك.</p>
    <a href="https://www.mizaniq.online/login" id="loginBtn" class="btn">الانتقال لتسجيل الدخول</a>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, applyActionCode } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDeBAgXm6L3NPTitSuzkS37ZFoyy_UvMHk",
        authDomain: "masar-5db30.firebaseapp.com",
        projectId: "masar-5db30",
        storageBucket: "masar-5db30.firebasestorage.app",
        messagingSenderId: "909223400853",
        appId: "1:909223400853:web:a64c4e243de8c1dc15d29c"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // الحصول على الكود من الرابط
    const urlParams = new URLSearchParams(window.location.search);
    const actionCode = urlParams.get('oobCode');

    const title = document.getElementById('title');
    const desc = document.getElementById('description');
    const iconContainer = document.getElementById('iconContainer');
    const loginBtn = document.getElementById('loginBtn');

    if (actionCode) {
        applyActionCode(auth, actionCode)
            .then(() => {
                // نجاح التأكيد
                iconContainer.innerHTML = '<i class="fas fa-check"></i>';
                iconContainer.className = 'status-icon success-icon';
                title.innerText = 'تم تأكيد الحساب بنجاح!';
                desc.innerText = 'شكراً لك. لقد تم التحقق من بريدك الإلكتروني بنجاح، يمكنك الآن استخدام كافة مميزات الأكاديمية.';
                loginBtn.style.display = 'inline-block';
            })
            .catch((error) => {
                // فشل التأكيد
                iconContainer.innerHTML = '<i class="fas fa-times"></i>';
                iconContainer.className = 'status-icon error-icon';
                title.innerText = 'فشل التأكيد';
                desc.innerText = 'الرابط غير صالح أو انتهت صلاحيته. يرجى طلب رابط تأكيد جديد من إعدادات حسابك.';
                loginBtn.style.display = 'inline-block';
                loginBtn.innerText = 'العودة للموقع';
            });
    } else {
        title.innerText = 'رابط غير صالح';
        desc.innerText = 'لم نتمكن من العثور على رمز التأكيد في الرابط.';
    }
</script>

</body>
</html>
